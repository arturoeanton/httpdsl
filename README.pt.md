# HTTP DSL üöÄ Seu Canivete Su√≠√ßo para Seguran√ßa e Integra√ß√£o de APIs

> *Porque proteger e integrar APIs n√£o deveria exigir um doutorado em DevOps*

Ol√°! üëã 

J√° passou horas escrevendo scripts para validar os headers de seguran√ßa da sua API? Lutou com workflows de integra√ß√£o complexos entre m√∫ltiplos servi√ßos? Ou precisou auditar rapidamente uma API em busca de vulnerabilidades mas se perdeu em ferramentas complicadas?

**N√≥s tamb√©m passamos por isso.** Por isso constru√≠mos o HTTP DSL - uma linguagem poderosa e leg√≠vel por humanos para valida√ß√£o de seguran√ßa de APIs, integra√ß√£o de servi√ßos e fluxos de trabalho automatizados.

## üí≠ Por Que Constru√≠mos Isso

Imagine isso: Voc√™ precisa validar que sua API est√° devidamente protegida contra vulnerabilidades comuns. Ou est√° orquestrando um workflow complexo entre m√∫ltiplos microsservi√ßos. Com ferramentas tradicionais, voc√™ precisaria de m√∫ltiplos scripts, frameworks e horas de configura√ß√£o. Com HTTP DSL?

```
# Valida√ß√£o de seguran√ßa em segundos
GET "https://api.seuservico.com/admin"
assert status 401  # Garantir que o acesso n√£o autorizado est√° bloqueado

GET "https://api.seuservico.com/login"
assert header "X-Frame-Options" exists  # Prote√ß√£o contra clickjacking
assert header "X-Content-Type-Options" "nosniff"  # Prote√ß√£o contra MIME sniffing
assert header "Strict-Transport-Security" exists  # Aplica√ß√£o de HTTPS
```

**√â s√≥ isso.** Valida√ß√£o de seguran√ßa instant√¢nea. Sem configura√ß√£o complexa. Sem necessidade de ser especialista em seguran√ßa.

## üéÅ O Que Torna Isso Especial?

N√£o criamos apenas outro cliente HTTP. Constru√≠mos uma ferramenta que **pensa como voc√™**:

```
# Lembra daquele fluxo de autentica√ß√£o chato que voc√™ sempre tem que testar?
POST "https://api.exemplo.com/login" json {
    "email": "usuario@exemplo.com",
    "password": "segredo123"
}
extract jsonpath "$.token" as $token

# Agora use em todo lugar, automaticamente
GET "https://api.exemplo.com/perfil" 
    header "Authorization" "Bearer $token"
    
# E realmente valide as coisas importantes
assert status 200
assert response contains "Bem-vindo de volta"
```

### üõ°Ô∏è Constru√≠do para Profissionais de Seguran√ßa e Integra√ß√£o

- **Valida√ß√£o de Seguran√ßa**: Verifica√ß√µes integradas para as vulnerabilidades OWASP Top 10
- **Orquestra√ß√£o de Servi√ßos**: Encadeia m√∫ltiplas APIs com l√≥gica condicional
- **Automa√ß√£o de Conformidade**: Valida requisitos GDPR, HIPAA, SOC2
- **Monitoramento de Desempenho**: Porque APIs lentas s√£o riscos de seguran√ßa
- **Trilhas de Auditoria**: Registro completo de solicita√ß√µes/respostas para conformidade

## ü§ù Isso √© Parte de Algo Maior

HTTP DSL √© alimentado por [**go-dsl**](https://github.com/arturoeanton/go-dsl), nosso framework para criar linguagens espec√≠ficas de dom√≠nio em Go. Se voc√™ j√° quis construir sua pr√≥pria mini-linguagem para suas necessidades espec√≠ficas, confira! Estamos construindo todo um ecossistema de ferramentas que tornam a vida dos desenvolvedores mais f√°cil.

## üö¶ Status Atual: v1.0.0 - Pronto para Produ√ß√£o!

Temos orgulho de dizer que alcan√ßamos v1.0.0! üéâ Isso significa:
- ‚úÖ 95% de cobertura de testes (testamos nossos testes!)
- ‚úÖ Testado em batalha em projetos reais
- ‚úÖ API est√°vel que n√£o quebrar√° seus scripts
- ‚úÖ Seu feedback ajudou a moldar cada recurso

Mas n√£o terminamos. Estamos apenas come√ßando.

## üöÄ In√≠cio R√°pido (30 Segundos para Seu Primeiro Teste!)

```bash
# Clonar e construir
git clone https://github.com/arturoeanton/httpdsl
cd httpdsl
go build -o httpdsl ./cmd/httpdsl/main.go

# Execute seu primeiro teste!
./httpdsl scripts/demos/01_basic.http
```

√â s√≥ isso! Sem arquivos de configura√ß√£o. Sem depend√™ncias para instalar. Simplesmente funciona. ‚ú®

## üéØ Casos de Uso do Mundo Real

### üõ°Ô∏è Su√≠te de Valida√ß√£o de Seguran√ßa
```
# auditoria_seguranca.http - Execute antes de cada implanta√ß√£o
GET "https://api.producao.com/api/v1/usuarios"
assert status 401  # Acesso n√£o autenticado deve ser bloqueado

# Verificar vulnerabilidades de inje√ß√£o SQL
GET "https://api.producao.com/buscar?q='; DROP TABLE usuarios--"
assert status 400  # Deve rejeitar entrada maliciosa
assert response not contains "SQL"  # N√£o vazar detalhes de erro

# Validar limite de taxa
repeat 20 times do
    GET "https://api.producao.com/api/endpoint"
endloop
assert status 429  # Limite de taxa deve ser ativado

# Verificar cabe√ßalhos de seguran√ßa
GET "https://api.producao.com/"
assert header "Content-Security-Policy" exists
assert header "X-XSS-Protection" "1; mode=block"
assert response time less 1000 ms  # Verifica√ß√£o de desempenho
```

### üîÑ Orquestra√ß√£o de Integra√ß√£o de Microsservi√ßos
```
# integracao_servicos.http
# Workflow complexo entre m√∫ltiplos servi√ßos

# Passo 1: Autenticar com o Servi√ßo de Auth
POST "https://auth.empresa.com/token" json {
    "grant_type": "client_credentials",
    "scope": "inventario:ler pedidos:escrever"
}
extract jsonpath "$.access_token" as $token_auth

# Passo 2: Verificar servi√ßo de invent√°rio
GET "https://inventario.empresa.com/produtos/SKU-123/disponibilidade"
    header "Authorization" "Bearer $token_auth"
extract jsonpath "$.quantidade_disponivel" as $estoque

if $estoque > 0 then
    # Passo 3: Criar pedido no Servi√ßo de Pedidos
    POST "https://pedidos.empresa.com/pedidos" json {
        "produto_id": "SKU-123",
        "quantidade": 1,
        "prioridade": "alta"
    }
    extract jsonpath "$.pedido_id" as $id_pedido
    
    # Passo 4: Acionar workflow de cumprimento
    POST "https://cumprimento.empresa.com/processar/$id_pedido"
    assert status 202  # Aceito para processamento
else
    # Acionar workflow de reabastecimento
    POST "https://inventario.empresa.com/solicitacoes-reabastecimento" json {
        "produto_id": "SKU-123",
        "urgencia": "alta"
    }
endif
```

### üîç Automa√ß√£o de Conformidade e Auditoria
```
# verificacao_conformidade.http - Valida√ß√£o GDPR/HIPAA

# Testar conformidade de privacidade de dados
POST "https://api.empresa.com/usuarios/solicitacao-exclusao" json {
    "usuario_id": "usuario-teste-123",
    "motivo": "GDPR Artigo 17"
}
assert status 200
assert response contains "exclusao_agendada"

# Verificar que os dados realmente s√£o exclu√≠dos
wait 5000 ms
GET "https://api.empresa.com/usuarios/usuario-teste-123"
assert status 404  # Usu√°rio deve ter desaparecido

# Verifica√ß√£o de registro de auditoria
GET "https://auditoria.empresa.com/logs?acao=exclusao_usuario&id=usuario-teste-123"
assert status 200
assert response contains "excluido_por"
assert response contains "timestamp_exclusao"
assert response contains "base_legal"
```

## üõ†Ô∏è Recursos Que Realmente Importam

### O Que Constru√≠mos (Com Amor üíô)

**O B√°sico** (porque deveria ser f√°cil):
- Todos os m√©todos HTTP - `GET`, `POST`, `PUT`, `DELETE`, o que voc√™ precisar
- Headers que se encadeiam naturalmente - chega de objetos de header!
- JSON que lida com s√≠mbolos @ e caracteres especiais (finalmente!)

**As Coisas Inteligentes** (porque voc√™ √© inteligente):
- Vari√°veis com `$` - como bash, mas mais amig√°vel
- Matem√°tica real - `set $total $preco * $quantidade * 1.08`
- If/else que faz sentido - at√© mesmo aninhados
- Loops - `while`, `foreach`, `repeat` com `break`/`continue`

**Os Economizadores de Tempo** (porque tempo √© precioso):
- Extraia qualquer coisa - JSONPath, regex, headers
- Valide tudo - status, tempo de resposta, conte√∫do
- Arrays com indexa√ß√£o - `$usuarios[0]`, `$itens[$indice]`
- Argumentos CLI - passe configura√ß√µes sem editar scripts

**O "Gra√ßas a Deus Algu√©m Construiu Isso"**:
- Sem setup, sem arquivos de config
- Scripts s√£o port√°teis - compartilhe com sua equipe
- Leg√≠vel por humanos - at√© n√£o-programadores entendem
- Erros que realmente dizem o que deu errado

## Instala√ß√£o

```bash
# Clonar o reposit√≥rio
git clone https://github.com/arturoeanton/httpdsl
cd httpdsl

# Construir a ferramenta CLI
go build -o httpdsl ./cmd/httpdsl/main.go

# Ou instalar globalmente
go install github.com/arturoeanton/httpdsl/cmd/httpdsl@latest
```

## üé® Integrar no Seu Projeto Go

Quer adicionar superpoderes do HTTP DSL √† sua pr√≥pria aplica√ß√£o Go? √â ridiculamente f√°cil:

### Instalar o M√≥dulo
```bash
go get github.com/arturoeanton/httpdsl
```

### Use no Seu C√≥digo
```go
package main

import (
    "fmt"
    "log"
    "httpdsl/core"
)

func main() {
    // Criar uma nova inst√¢ncia do HTTP DSL
    dsl := core.NewHTTPDSLv3()
    
    // Seu script DSL como string (pode vir de um arquivo, BD, ou API)
    script := `
        # Testar a sa√∫de da nossa API
        GET "https://api.exemplo.com/health"
        assert status 200
        
        # Login e obter token
        POST "https://api.exemplo.com/login" json {
            "username": "usuarioteste",
            "password": "senhateste"
        }
        extract jsonpath "$.token" as $token
        
        # Usar o token para requisi√ß√µes autenticadas
        GET "https://api.exemplo.com/usuarios/eu"
            header "Authorization" "Bearer $token"
        
        if status == 200 then
            print "‚úÖ Todos os sistemas operacionais!"
        else
            print "‚ùå Algo deu errado"
        endif
    `
    
    // Executar o script
    result, err := dsl.ParseWithBlockSupport(script)
    if err != nil {
        log.Fatal("Script falhou:", err)
    }
    
    // Acessar vari√°veis ap√≥s a execu√ß√£o
    token := dsl.GetVariable("token")
    fmt.Printf("Token obtido: %v\n", token)
}
```

### Exemplos de Integra√ß√£o do Mundo Real

**1. Verifica√ß√µes de Sa√∫de Automatizadas**
```go
func verificacaoSaude(apiURL string) error {
    dsl := core.NewHTTPDSLv3()
    script := fmt.Sprintf(`
        GET "%s/health"
        assert status 200
        assert time less 1000 ms
    `, apiURL)
    
    _, err := dsl.ParseWithBlockSupport(script)
    return err
}
```

**2. Executor de Testes Din√¢mico**
```go
func executarSuiteDeTestes(arquivoTeste string, env map[string]string) {
    dsl := core.NewHTTPDSLv3()
    
    // Definir vari√°veis de ambiente
    for chave, valor := range env {
        dsl.SetVariable(chave, valor)
    }
    
    // Carregar e executar script de teste
    script, _ := os.ReadFile(arquivoTeste)
    result, err := dsl.ParseWithBlockSupport(string(script))
    
    if err != nil {
        log.Printf("Teste falhou: %v", err)
    }
}
```

**3. Integra√ß√£o com Pipeline CI/CD**
```go
func validadorImplantacao(urlImplantacao string) bool {
    dsl := core.NewHTTPDSLv3()
    
    scriptValidacao := `
        set $tentativas 0
        set $saudavel false
        
        while $tentativas < 5 and $saudavel == false do
            GET "%s"
            if status == 200 then
                set $saudavel true
            else
                wait 2000 ms
                set $tentativas $tentativas + 1
            endif
        endloop
        
        if $saudavel == false then
            print "Valida√ß√£o da implanta√ß√£o falhou ap√≥s 5 tentativas"
        endif
    `
    
    script := fmt.Sprintf(scriptValidacao, urlImplantacao)
    _, err := dsl.ParseWithBlockSupport(script)
    
    return dsl.GetVariable("saudavel") == true
}
```

### Acessar Componentes do DSL

```go
// Obter todas as vari√°veis ap√≥s a execu√ß√£o
vars := dsl.GetVariables()

// Definir vari√°veis iniciais antes da execu√ß√£o
dsl.SetVariable("baseURL", "https://api.producao.com")
dsl.SetVariable("apiKey", os.Getenv("API_KEY"))

// Acessar o motor HTTP para configura√ß√µes personalizadas
engine := dsl.GetHTTPEngine()
engine.SetTimeout(30 * time.Second)
```

### Por Que Integrar o HTTP DSL?

- **Chega de Manuten√ß√£o de C√≥digo de Testes**: Testes se tornam dados, n√£o c√≥digo
- **N√£o-Desenvolvedores Podem Escrever Testes**: Gerentes de produto, QA, qualquer um!
- **Gera√ß√£o Din√¢mica de Testes**: Gere testes baseados em especifica√ß√µes OpenAPI
- **Bibliotecas de Testes Reutiliz√°veis**: Compartilhe arquivos `.http` entre projetos
- **Testes com Recarga a Quente**: Mude testes sem recompilar

## Uso

### Exemplo de Produ√ß√£o (Tudo Funcionando!)

```
# Todo este script FUNCIONA em v1.0.0!
set $base_url "https://jsonplaceholder.typicode.com"
set $api_version "v3"

# M√∫ltiplos headers - FUNCIONA!
GET "$base_url/posts/1" 
    header "Accept" "application/json"
    header "X-API-Version" "$api_version"
    header "X-Request-ID" "test-123"
    header "Cache-Control" "no-cache"

assert status 200
extract jsonpath "$.userId" as $user_id

# JSON com s√≠mbolos @ - FUNCIONA!
POST "$base_url/posts" json {
    "title": "Notifica√ß√µes por email",
    "body": "Enviar para usuario@exemplo.com com @men√ß√µes e #tags",
    "userId": 1
}

assert status 201
extract jsonpath "$.id" as $post_id

# Express√µes aritm√©ticas - FUNCIONANDO!
set $pontuacao_base 100
set $bonus 25
set $total $pontuacao_base + $bonus
set $final $total * 1.1
print "Pontua√ß√£o final: $final"

# Condicionais - FUNCIONANDO!
if $post_id > 0 then set $status "SUCESSO" else set $status "FALHA"
print "Status de cria√ß√£o: $status"

# Loops com break/continue - FUNCIONANDO!
set $contador 0
while $contador < 10 do
    if $contador == 5 then
        break
    endif
    set $contador $contador + 1
endloop

# Opera√ß√µes com arrays - NOVO em v1.0.0!
set $frutas "[\"ma√ß√£\", \"banana\", \"laranja\"]"
set $primeira $frutas[0]  # Indexa√ß√£o de arrays com colchetes
set $tamanho length $frutas  # Fun√ß√£o length
foreach $item in $frutas do
    print "Fruta: $item"
endloop

# Argumentos CLI - NOVO em v1.0.0!
if $ARGC > 0 then
    print "Primeiro argumento: $ARG1"
endif

print "Todos os testes completados com sucesso!"
```

### Usando o Executor

```bash
# Executar um arquivo de script
./httpdsl scripts/demos/demo_complete.http

# Passar argumentos de linha de comando para o script
./httpdsl script.http arg1 arg2 arg3

# Com sa√≠da detalhada
./httpdsl -v scripts/demos/06_loops.http

# Parar no primeiro erro
./httpdsl -stop scripts/demos/04_conditionals.http

# Execu√ß√£o a seco (validar sem executar)
./httpdsl --dry-run scripts/demos/05_blocks.http

# Validar apenas a sintaxe
./httpdsl --validate scripts/demos/02_headers_json.http
```

## üíù Precisamos de Voc√™! (Sim, Voc√™!)

Este projeto existe porque desenvolvedores como voc√™ disseram "tem que haver um jeito melhor". E estavam certos.

### Como Voc√™ Pode Ajudar a Tornar os Testes Melhores para Todos

**üêõ Encontrou um Bug?** 
N√£o sofra em sil√™ncio! [Abra uma issue](https://github.com/arturoeanton/httpdsl/issues) e vamos consertar juntos. Nenhum bug √© pequeno demais.

**üí° Tem uma Ideia?**
Aquele recurso que voc√™ gostaria que existisse? Vamos constru√≠-lo! Abra uma discuss√£o e compartilhe seus pensamentos.

**üìù Melhorar a Documenta√ß√£o?**
Se algo confundiu voc√™, confundir√° outros. Ajude-nos a tornar mais claro!

**‚≠ê Apenas nos D√™ uma Estrela!**
S√©rio, ajuda mais do que voc√™ imagina. Nos diz que estamos no caminho certo.

### Contribuindo com C√≥digo

```bash
# Fork, clone e crie sua branch de recurso
git checkout -b meu-recurso-incrivel

# Fa√ßa suas mudan√ßas e teste-as
go test ./...

# Push e crie um PR!
```

Prometemos:
- üöÄ Revisar PRs rapidamente (geralmente em 48h)
- üí¨ Fornecer feedback construtivo e gentil
- üéâ Celebrar sua contribui√ß√£o publicamente
- üìù Dar cr√©dito a voc√™ em nossos releases

### üåü Nossos Incr√≠veis Contribuidores

Cada pessoa que contribui torna isso melhor. Seja c√≥digo, documenta√ß√£o, relat√≥rios de bugs, ou apenas espalhar a palavra - **voc√™ importa**.

## ü§≤ Junte-se √† Nossa Comunidade

**N√£o estamos construindo uma ferramenta. Estamos construindo uma comunidade de desenvolvedores que acreditam que testes deveriam ser simples.**

- üê¶ Compartilhe seus scripts e dicas com #httpdsl
- üí¨ [Junte-se √†s nossas discuss√µes](https://github.com/arturoeanton/httpdsl/discussions)
- üìß Entre em contato diretamente - n√≥s realmente respondemos!

## üé≠ O Panorama Geral

HTTP DSL √© orgulhosamente alimentado por [**go-dsl**](https://github.com/arturoeanton/go-dsl) - nosso framework para construir linguagens espec√≠ficas de dom√≠nio. Juntos, estamos fazendo ferramentas de desenvolvimento que respeitam seu tempo e intelig√™ncia.

## üìú Licen√ßa

MIT - Porque grandes ferramentas deveriam ser gr√°tis para todos.

## üôè Pensamentos Finais

Constru√≠mos isso porque precis√°vamos. Mantemos porque voc√™ tamb√©m precisa. Cada issue que voc√™ abre, cada PR que voc√™ envia, cada estrela que voc√™ d√° - tudo nos lembra por que fazemos isso.

**Obrigado por fazer parte desta jornada.**

Vamos tornar os testes agrad√°veis novamente! üöÄ

---

<p align="center">
Feito com ‚ù§Ô∏è por desenvolvedores que estavam cansados de testes complexos
<br>
<b>HTTP DSL v1.0.0</b> - Seu companheiro de testes
<br>
<i>"Ferramentas simples para problemas complexos"</i>
</p>

<p align="center">
  <a href="https://github.com/arturoeanton/httpdsl">‚≠ê Nos d√™ uma estrela</a> ‚Ä¢
  <a href="https://github.com/arturoeanton/httpdsl/issues">üêõ Reportar Bug</a> ‚Ä¢
  <a href="https://github.com/arturoeanton/httpdsl/discussions">üí¨ Discuss√µes</a> ‚Ä¢
  <a href="https://github.com/arturoeanton/go-dsl">üîß go-dsl</a>
</p>