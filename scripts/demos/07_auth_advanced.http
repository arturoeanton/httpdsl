# Demo 7: AutenticaciÃ³n y Headers Avanzados
# Aprende a usar diferentes tipos de autenticaciÃ³n y headers avanzados

print "=== Demo 7: AutenticaciÃ³n y Headers Avanzados ==="

set $api_base "https://jsonplaceholder.typicode.com"
set $mock_token "bearer-token-12345"
set $api_key "api-key-abcdef"

# Request con Bearer Authentication (simulado)
print "ğŸ” Probando Bearer Authentication..."
GET "$api_base/posts/1"
    header "Authorization" "Bearer $mock_token"
    header "X-API-Key" "$api_key"
    header "Accept" "application/json"
    header "User-Agent" "HTTPDSLv3-Demo/1.0"
    header "X-Request-ID" "demo-auth-001"

assert status 200
print "âœ… Authentication headers enviados correctamente"

# Request con headers condicionales
set $user_role "admin"
if $user_role == "admin" then set $auth_header "Bearer admin-token" else set $auth_header "Bearer user-token"

print "ğŸ¯ Headers dinÃ¡micos basados en rol: $user_role"
GET "$api_base/users/1"
    header "Authorization" "$auth_header"
    header "X-User-Role" "$user_role"
    header "Content-Type" "application/json"

assert status 200
extract jsonpath "$.name" as $user_name
print "Usuario autenticado: $user_name"

# Simular diferentes niveles de autenticaciÃ³n
repeat 2 times do
    if $user_role == "admin" then
        print "ğŸ”“ Acceso de administrador - Datos sensibles"
        GET "$api_base/users"
        assert status 200
        set $access_granted "full"
    else
        print "ğŸ‘¤ Acceso de usuario regular - Datos pÃºblicos"  
        GET "$api_base/posts"
        assert status 200
        set $access_granted "limited"
    endif
    
    print "Acceso otorgado: $access_granted"
    
    # Cambiar rol para la siguiente iteraciÃ³n
    set $user_role "user"
endloop

# Headers con informaciÃ³n de contexto
set $client_version "3.1.0"
set $platform "linux"

print "ğŸ“± Request con informaciÃ³n de contexto..."
GET "$api_base/posts/1"
    header "X-Client-Version" "$client_version"
    header "X-Platform" "$platform"
    header "X-Timestamp" "2024-12-12T10:30:00Z"
    header "Accept-Encoding" "gzip, deflate"
    header "Cache-Control" "no-cache"

assert status 200

print "âœ… Demo 7 completado - AutenticaciÃ³n y headers avanzados!"